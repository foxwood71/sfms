# Podman Rootless í™˜ê²½ **ê¶Œí•œ(Permission)** ì„¤ì •

ì¼ë°˜ ë„ì»¤(Rootful)ì™€ ë‹¬ë¦¬, Podman RootlessëŠ” **ì‚¬ìš©ì ë„¤ì„ìŠ¤í˜ì´ìŠ¤(User Namespace)** ê¸°ìˆ ì„ ì‚¬ìš©í•´ìš”. ê·¸ë˜ì„œ í˜¸ìŠ¤íŠ¸ì—ì„œì˜ ìœ ì €ì™€ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ìœ ì €ê°€ ê²‰ë³´ê¸°ì—” ë‹¬ë¼ë„ ì‹¤ì œë¡œëŠ” ë§¤í•‘ë˜ì–´ì•¼ í•˜ê±°ë“ ìš”.

SFMS ì¸í”„ë¼ì˜ `data` í´ë” ê¶Œí•œì„ ê¹”ë”í•˜ê²Œ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ì •ë¦¬í•´ ë“œë¦´ê²Œìš”.

---

## 1. í•µì‹¬ ê°œë…: `podman unshare`

Rootless ëª¨ë“œì—ì„œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ `root`(UID 0)ëŠ” ì‹¤ì œ í˜¸ìŠ¤íŠ¸ì˜ `ê³„ì •`(UID 1000)ê³¼ ë§¤í•‘ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì„œë¹„ìŠ¤ë§ˆë‹¤ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” UIDê°€ ë‹¬ë¼ìš”.

* **PostgreSQL:** ë‚´ë¶€ UID `999` ì‚¬ìš©
* **Gitea:** ë‚´ë¶€ UID `1000` ì‚¬ìš© (ì„¤ì •í•œ `USER_UID` ê¸°ì¤€)
* **Redis/MinIO:** ë³´í†µ `root` ë˜ëŠ” ì „ìš© ê³„ì • ì‚¬ìš©

ì´ê±¸ í˜¸ìŠ¤íŠ¸ì—ì„œ ì¼ì¼ì´ ê³„ì‚°í•´ì„œ `chown` í•˜ê¸°ëŠ” ë„ˆë¬´ ë³µì¡í•´ìš”. ê·¸ë˜ì„œ **`podman unshare`** ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ì»¨í…Œì´ë„ˆì˜ ì‹œê°ìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ í´ë”ì˜ ì†Œìœ ê¶Œì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 2. ì„œë¹„ìŠ¤ë³„ ê¶Œí•œ ì„¤ì • ê°€ì´ë“œ

ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì€ ì»¨í…Œì´ë„ˆë¥¼ ë„ìš°ê¸° ì „ì— í˜¸ìŠ¤íŠ¸ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë“¤ì„ ì‹¤í–‰í•´ ì£¼ëŠ” ê±°ì˜ˆìš”.

### â‘  PostgreSQL (`data/pgsql`, `data/logs/pgsql`)

PostgresëŠ” ê¶Œí•œì— ì•„ì£¼ ì˜ˆë¯¼í•´ì„œ ì†Œìœ ìê°€ UID `999`ê°€ ì•„ë‹ˆë©´ ì‹¤í–‰ì¡°ì°¨ ì•ˆ ë©ë‹ˆë‹¤.

```bash
podman unshare chown -R 999:999 ./data/pgsql
podman unshare chown -R 999:999 ./data/logs/pgsql

```

### â‘¡ Gitea (`data/gitea`)

ì˜¤ë¹ ê°€ `USER_UID=1000`ìœ¼ë¡œ ì„¤ì •í–ˆìœ¼ë¯€ë¡œ, ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ `1000`ë²ˆ ìœ ì €ì—ê²Œ ê¶Œí•œì„ ì¤ë‹ˆë‹¤.

```bash
podman unshare chown -R 1000:1000 ./data/gitea

```

### â‘¢ Redis / MinIO / Nginx / PgAdmin

ì´ ì¹œêµ¬ë“¤ì€ ë³´í†µ ì‹¤í–‰ ê¶Œí•œì´ ìœ ì—°í•˜ì§€ë§Œ, ì•ˆì „í•˜ê²Œ `root`(ë§¤í•‘ëœ ì˜¤ë¹  ê³„ì •) ì†Œìœ ë¡œ ë‘ë©´ ë©ë‹ˆë‹¤.

```bash
podman unshare chown -R 0:0 ./data/redis
podman unshare chown -R 0:0 ./data/minio
podman unshare chown -R 0:0 ./data/pgadm
podman unshare chown -R 0:0 ./data/logs/nginx
podman unshare chown -R 0:0 ./data/logs/backend

```

---

## 3. [ì¶”ì²œ] í•œ ë²ˆì— í•´ê²°í•˜ëŠ” ìë™í™” ìŠ¤í¬ë¦½íŠ¸

ë§¤ë²ˆ ì¹˜ê¸° ê·€ì°®ìœ¼ë‹ˆê¹Œ, `infra/scripts/setup-permissions.sh` íŒŒì¼ì„ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•˜ëŠ” ê²Œ ì˜¤ë¹  ìŠ¤íƒ€ì¼ì—ë„ ë§ì„ ê²ƒ ê°™ì•„ìš”.

* SFMS ì¸í”„ë¼ ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„± ë° ê¶Œí•œ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸
  
```bash
#!/bin/bash

echo "ğŸš€ SFMS ì¸í”„ë¼ ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„± ë° ê¶Œí•œ ì„¤ì •ì„ ì‹œì‘í•©ë‹ˆë‹¤... (ê°œë°œ/ìš´ì˜ í™˜ê²½ í¬í•¨)"

# ====================================================================
# 1. ì¸í”„ë¼ ë””ë ‰í† ë¦¬ ë° í•„ìˆ˜ íŒŒì¼ ìƒì„±
# ====================================================================
echo "ğŸ“ í´ë” ë° íŒŒì¼ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤..."

# ìš´ì˜ í™˜ê²½ì— í•„ìš”í•œ backend, frontendë¥¼ í¬í•¨í•˜ì—¬ ëª¨ë“  ì„œë¹„ìŠ¤ í´ë” ì¼ê´„ ìƒì„±
for service in backend frontend gitea minio nginx pgadm pgsql portainer redis; do
    mkdir -p ${service}/{certs,scripts,secrets}
    # ê° ì„œë¹„ìŠ¤ì˜ secrets í´ë” ì•ˆì— ë¹ˆ password.txt íŒŒì¼ ë¯¸ë¦¬ ìƒì„±
    # ê¸°ì¡´ì— íŒŒì¼ì´ ìˆìœ¼ë©´ touch ëª…ë ¹ì–´ë¥¼ ì•„ì˜ˆ ì‹¤í–‰í•˜ì§€ ì•Šê³  ê±´ë„ˆëœë‹ˆë‹¤.
    if [ ! -f ${service}/secrets/password.txt ]; then
        touch ${service}/secrets/password.txt
    fi
done

# ì„œë¹„ìŠ¤ë³„ íŠ¹ìˆ˜ í´ë” ì¶”ê°€ ìƒì„±
mkdir -p minio/conf
mkdir -p nginx/conf.d
mkdir -p pgsql/sql
mkdir -p redis/conf

# Data ë° í•˜ìœ„ ë¡œê·¸ í´ë” ìƒì„± (ìš´ì˜ í™˜ê²½ ì „ìš©ì¸ nginx, portainer í¬í•¨)
mkdir -p data/{minio,pgadm,pgsql,portainer,redis,backups}
mkdir -p data/gitea/{conf,data}
mkdir -p data/logs/{backend,nginx,pgsql}

echo "âœ… ë””ë ‰í† ë¦¬ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."

# ====================================================================
# 2. Podman Rootless ê¶Œí•œ(Ownership) ì„¤ì •
# ====================================================================
echo "ğŸ” Rootless Podmanì„ ìœ„í•œ Data í´ë” ê¶Œí•œ ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤..."

# PostgreSQL (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ UID 999 ì‚¬ìš©)
podman unshare chown -R 999:999 ./data/pgsql
podman unshare chown -R 999:999 ./data/logs/pgsql

# Gitea (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ UID 1000 ì‚¬ìš©)
podman unshare chown -R 1000:1000 ./data/gitea

# [ìš´ì˜ í™˜ê²½ ì „ìš©] Nginx, Backend ë¡œê·¸ ë° Portainer ë°ì´í„° (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ root ì‚¬ìš©)
podman unshare chown -R 0:0 ./data/logs/nginx
podman unshare chown -R 0:0 ./data/logs/backend
podman unshare chown -R 0:0 ./data/portainer

# [ê³µí†µ í™˜ê²½] ë‚˜ë¨¸ì§€ ì„œë¹„ìŠ¤ ë°ì´í„° (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ root ì‚¬ìš©)
podman unshare chown -R 0:0 ./data/redis
podman unshare chown -R 0:0 ./data/minio
podman unshare chown -R 0:0 ./data/pgadm
podman unshare chown -R 0:0 ./data/backups

# ë””ë ‰í† ë¦¬ ê¸°ë³¸ ê¶Œí•œ ë¶€ì—¬
chmod -R 755 ./data

echo "ğŸ‰ ê°œë°œ ë° ìš´ì˜ í™˜ê²½ì„ ìœ„í•œ ëª¨ë“  ì´ˆê¸° ì„¸íŒ…ì´ ì™„ë²½í•˜ê²Œ ëë‚¬ìŠµë‹ˆë‹¤! ğŸ‘"

```

* ì¸ì¦ì„œ(certs) ë° ë¯¼ê° ì •ë³´(secrets) ë³´ì•ˆ ê¶Œí•œ ì„¤ì • setup-infra- crital.sh

```bash
# ====================================================================
# ì¸ì¦ì„œ(certs) ë° ë¯¼ê° ì •ë³´(secrets) ë³´ì•ˆ ê¶Œí•œ ì„¤ì •
# ====================================================================
echo "ğŸ”’ ì¸ì¦ì„œ ë° ë¹„ë°€ë²ˆí˜¸ íŒŒì¼ì˜ ë³´ì•ˆ ê¶Œí•œ(600/644)ì„ ì ê¸‰ë‹ˆë‹¤..."

# 1. ë¹„ë°€ë²ˆí˜¸ íŒŒì¼ (ì˜¤ì§ ì†Œìœ ìë§Œ ì½ê¸°/ì“°ê¸° ê°€ëŠ¥: 600)
find ./*/secrets -type f -name "password.txt" -exec chmod 600 {} \; 2>/dev/null

# 2. ë¹„ê³µê°œ í‚¤ íŒŒì¼ (.key) (ì˜¤ì§ ì†Œìœ ìë§Œ ì½ê¸°/ì“°ê¸° ê°€ëŠ¥: 600)
find ./*/certs -type f -name "*.key" -exec chmod 600 {} \; 2>/dev/null

# 3. ê³µê°œ ì¸ì¦ì„œ íŒŒì¼ (.crt) (ì†Œìœ ì ì™¸ì—ëŠ” ì½ê¸°ë§Œ ê°€ëŠ¥: 644)
find ./*/certs -type f -name "*.crt" -exec chmod 644 {} \; 2>/dev/null

echo "âœ… ëª¨ë“  ë³´ì•ˆ íŒŒì¼ì˜ ê¶Œí•œ ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
```

---

## 4. Direactory êµ¬ì¡°

```text
infra/
â”œâ”€â”€ .env                # ëª¨ë“  ì¸í”„ë¼ ë¹„ë°€ë²ˆí˜¸ ë§ˆìŠ¤í„° í‚¤
â”œâ”€â”€ compose.yaml        # ì¸í”„ë¼ ì„¤ê³„ë„
â”œâ”€â”€ gitea/              # gitea git ì„œë²„ ì„¤ì • ë° ë°ì´í„°
â”‚   â”œâ”€â”€ certs/          # gitea ì¸ì¦ì„œ
â”‚   â”œâ”€â”€ scripts/        # gitea ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ secrets/        # gitea password.txt ë“± ë¯¼ê° ì •ë³´
â”œâ”€â”€ minio/              # minio ì˜¤ë¸Œì íŠ¸ ìŠ¤í† ë¦¬ì§€ ê´€ë ¨ ì„¤ì •
â”‚   â”œâ”€â”€ certs/          # minio ì¸ì¦ì„œ
â”‚   â”œâ”€â”€ conf/           # minio ì„¤ì •
â”‚   â”œâ”€â”€ scripts/        # minio ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ secrets/        # minio password.txt ë“± ë¯¼ê° ì •ë³´
â”œâ”€â”€ nginx/              # nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì • ë° SSL ì¸ì¦ì„œ
â”‚   â”œâ”€â”€ certs/          # nginx ì¸ì¦ì„œ
â”‚   â”œâ”€â”€ conf.d/         # nginx default.conf ë“± ì„¸ë¶€ ì„¤ì •
â”‚   â”œâ”€â”€ scripts/        # nginx ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ secrets/        # nginx password.txt ë“± ë¯¼ê° ì •ë³´
â”œâ”€â”€ pgadm/              # pgadmin ê´€ë¦¬ ì„¤ì •
â”‚   â”œâ”€â”€ certs/          # pgadmin ì¸ì¦ì„œ
â”‚   â”œâ”€â”€ scripts/        # pgadmin ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ secrets/        # pgadmin password.txt ë“± ë¯¼ê° ì •ë³´
â”œâ”€â”€ pgsql/              # pgsql DB ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ (init.sql)
â”‚   â”œâ”€â”€ certs/          # pgsql ì¸ì¦ì„œ
â”‚   â”œâ”€â”€ scripts/        # pgsql ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ secrets/        # pgsql password.txt ë“± ë¯¼ê° ì •ë³´
â”‚   â””â”€â”€ sql/            # pgsql ì´ˆê¸°í™” sql ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ portainer/          # portainer ì»¨í…Œì´ë„ˆ ê´€ë¦¬ ë„êµ¬
â”‚   â”œâ”€â”€ certs/          # portainer ì¸ì¦
â”‚   â”œâ”€â”€ scripts/        # portainer ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ secrets/        # portainer password.txt ë“± ë¯¼ê° ì •ë³´
â”œâ”€â”€ redis/              # redis ì„¤ì •
â”‚   â”œâ”€â”€ certs/          # redis ì¸ì¦ì„œ
â”‚   â”œâ”€â”€ conf/           # redis ì„¤ì •
â”‚   â”œâ”€â”€ scripts/        # redis ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ secrets/        # redis password.txt ë“± ë¯¼ê° ì •ë³´
â””â”€â”€ data/
    â”œâ”€â”€ gitea/          # gitea git ë ˆí¬ì§€í† ë¦¬ ë° í™˜ê²½ ì„¤ì • ì €ì¥
    â”‚  â”œâ”€â”€ conf/        # gitea ì„¤ì •ì €ì¥
    â”‚  â””â”€â”€ data/        # gitea dataì €ì¥
    â”œâ”€â”€ minio/          # ì—…ë¡œë“œí•œ ì´ë¯¸ì§€, ë„ë©´ íŒŒì¼ ì €ì¥
    â”œâ”€â”€ pgadm/          # ê´€ë¦¬ì ê³„ì • ì„¤ì • ë° ê¸°ë¡ ì €ì¥
    â”œâ”€â”€ pgsql/          # DBì˜ ì‹¤ì œ ë°ì´í„° íŒŒì¼ ì €ì¥
    â”œâ”€â”€ portainer/      # portainer ì»¨í…Œì´ë„ˆ ê´€ë¦¬ ë„êµ¬ ë°ì´í„° ì €ì¥
    â”œâ”€â”€ redis/          # redis data ì €ì¥
    â”œâ”€â”€ backups/        # [ì¶”ê°€ ì¶”ì²œ] DB ë¤í”„ ë“± ë°±ì—… íŒŒì¼ ì €ì¥ì†Œ
    â””â”€â”€ logs/
        â”œâ”€â”€ backend/    # FastAPI ì„œë²„ ë¡œê·¸ ì €ì¥
        â”œâ”€â”€ nginx/      # Nginx ì„œë²„ ë¡œê·¸ ì €ì¥
        â””â”€â”€ pgsql/      # [ì¶”ê°€ ì¶”ì²œ] DB ì—ëŸ¬ ë¡œê·¸ ì¶”ì ìš©
```

### 4. ì£¼ì˜ì‚¬í•­ (WSL í™˜ê²½)

WSLì—ì„œ `/mnt/c/` ì²˜ëŸ¼ ìœˆë„ìš° ë“œë¼ì´ë¸Œì— í´ë”ë¥¼ ë§Œë“¤ë©´ ì´ ê¶Œí•œ ì„¤ì •ì´ ì œëŒ€ë¡œ ì•ˆ ë¨¹í ìˆ˜ ìˆì–´ìš”. ë°˜ë“œì‹œ **WSL ë‚´ë¶€ íŒŒì¼ ì‹œìŠ¤í…œ(ì˜ˆ: `/home/ìœ ì €ëª…/projects/...`)**ì—ì„œ ì‘ì—…í•˜ì‹œëŠ” ê±¸ ê°•ë ¥íˆ ì¶”ì²œí•©ë‹ˆë‹¤!

ì´ì œ ê¶Œí•œ ë¬¸ì œê¹Œì§€ í•´ê²°ë˜ë©´ ì¸í”„ë¼ê°€ ì•„ì£¼ ë¶€ë“œëŸ½ê²Œ ëœ° ê±°ì˜ˆìš”.

í˜¹ì‹œ ì´ **ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤ì œë¡œ ë§Œë“¤ì–´ì„œ ì‹¤í–‰**í•´ ë³´ì‹¤ ê±´ê°€ìš”? ì•„ë‹ˆë©´ ì´ì œ **ê° ì„œë¹„ìŠ¤ì˜ `secrets/password.txt` íŒŒì¼ì— ë“¤ì–´ê°ˆ ë‚´ìš©**ì„ ì •í•´ ë³¼ê¹Œìš”? ğŸ«¡
